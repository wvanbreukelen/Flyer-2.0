<?php

/**
 * Setting up envirorment for console applications
 */

define("ENV_CONSOLE", true);

/**
 * Require the composer autoloader for autoloading our dependencies
 */

require('vendor/autoload.php');

/**
 * Autoload the framework and get a fresh prepared application instance returned
 */

$app = require('bootstrap/autoload.php');

/**
 * Load up the routes file in the app folder
 */

require($app->appPath() . 'routes.php');

/**
 * Boot the application
 */

$app->boot();

/**
 * Create a new Commandr instance
 */

$commandr = new Commandr\Core\Application(
	new Commandr\Core\Input,
	new Commandr\Core\Output,
	new Commandr\Core\Dialog,
	'Commandr Console helping application',
	'1.0'
);

/**
 * Set the commandr config file
 */

$config = new Commandr\Core\Config(require($app->configPath() . 'commandr.php'));

$commandr->setConfig($config);

/**
 * Add the commands from the config file to Commandr
 */

$commandr->addCommands($config->get('commands'));

/**
 * Match the given input with one of the registered commands
 */

$commandr->match();

/**
 * Run Commandr
 */

$commandr->run(new Commandr\Core\Output());
